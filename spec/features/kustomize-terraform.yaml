name: Multiple Resources
deployment:
  hostedDeployment:
    AwsAccountId: 'xxxxxxxxxx'
    AwsBootstrapRoleAccountArn: 'arn:aws:iam::xxxxxxxxxx:role/omnistrate-bootstrap-role'
    GcpProjectId: 'xxxxxxxxxx'
    GcpProjectNumber: 'xxxxxxxxxx'
    GcpServiceAccountEmail: 'bootstrap@xxxxxxxxxx.iam.gserviceaccount.com'
    AzureSubscriptionId: 'xxxxxxxxxx'
    AzureTenantId: 'xxxxxxxxxx'
features:
  INTERNAL:
    logs: # Omnistrate native
  CUSTOMER:
    logs: # Omnistrate native

x-git-token: &git-token github_pat_placeholder
x-git-configuration: &git-configuration
  reference: refs/heads/master
  repositoryUrl: https://github.com/organization/repo.git
  accessToken: *git-token

services:
  - name: terraformChild
    internal: true
    terraformConfigurations:
      configurationPerCloudProvider:
        aws:
          terraformPath: /aws/terraform
          gitConfiguration:
            <<: *git-configuration
          privateModuleGitAccessTokens:
            token: *git-token
          terraformExecutionIdentity: "arn:aws:iam::xxxxxxxxx:role/omnistrate-custom-terraform-execution-role"
        gcp:
          terraformPath: /gcp/terraform
          gitConfiguration:
            <<: *git-configuration
          privateModuleGitAccessTokens:
            token: *git-token
          terraformExecutionIdentity: "xxxxxxxxxx@xxxxxxxxxx.iam.gserviceaccount.com"
        azure:
          terraformPath: /azure/terraform
          gitConfiguration:
            <<: *git-configuration
          privateModuleGitAccessTokens:
            token: *git-token
  - name: terraformChild2
    internal: true
    terraformConfigurations:
      configurationPerCloudProvider:
        aws:
          terraformPath: /aws/terraform2
          gitConfiguration:
            <<: *git-configuration
          terraformExecutionIdentity: "arn:aws:iam::xxxxxxxxxx:role/omnistrate-custom-terraform-execution-role"
        gcp:
          terraformPath: /gcp/terraform2
          gitConfiguration:
            <<: *git-configuration
          terraformExecutionIdentity: "xxxxxxxxxx@xxxxxxxxxx.iam.gserviceaccount.com"
        azure:
          terraformPath: /azure/terraform2
          gitConfiguration:
            <<: *git-configuration
          privateModuleGitAccessTokens:
            token: *git-token
  - name: kustomizeRoot
    dependsOn:
      - terraformChild
      - terraformChild2
    compute:
      instanceTypes:
        - name: t4g.small
          cloudProvider: aws
          configurationOverrides:
            taints:
              - key: "example-toleration"
                value: "enabled"
                effect: NoSchedule
        - name: e2-medium
          cloudProvider: gcp
        - name: Standard_B2ms
          cloudProvider: azure
    network:
      ports:
        - 3306
    kustomizeConfiguration:
      kustomizePath: /kustomize
      gitConfiguration:
        <<: *git-configuration
    apiParameters:
      - key: username
        description: Username
        name: Username
        type: String
        modifiable: true
        required: false
        export: true
        defaultValue: username
      - key: password
        description: Default DB Password
        name: Password
        type: String
        modifiable: false
        required: false
        export: false
        defaultValue: postgres
