name: Multiple Resources
deployment:
  hostedDeployment:
    AwsAccountId: '339713121445'
    AwsBootstrapRoleAccountArn: 'arn:aws:iam::339713121445:role/omnistrate-bootstrap-role'
    GcpProjectId: 'omnistrate-dataplane-host-dev'
    GcpProjectNumber: '61114262792'
    GcpServiceAccountEmail: 'bootstrap@omnistrate-dataplane-host-dev.iam.gserviceaccount.com'
    AzureSubscriptionId: '0fa05079-dd73-4b88-babc-05537817604a'
    AzureTenantId: '4e6c839d-e141-462e-bc65-8cd863580351'

x-git-configuration: &git-configuration
  reference: refs/heads/master
  repositoryUrl: https://github.com/omnistrate/resource-spec-samples.git
  accessToken: github_pat_placeholder

services:
  - name: terraformChild
    internal: true
    terraformConfigurations:
      configurationPerCloudProvider:
        aws:
          terraformPath: /e2etestv2/original/aws/terraform
          gitConfiguration:
            <<: *git-configuration
          terraformExecutionIdentity: "arn:aws:iam::339713121445:role/omnistrate-custom-terraform-execution-role"
        gcp:
          terraformPath: /e2etestv2/original/gcp/terraform
          gitConfiguration:
            <<: *git-configuration
          # Identity needs permissions to create Cloud SQL. Following role(s) should be bound: roles/cloudsql.admin
          terraformExecutionIdentity: "omnistrate-tf-org-euvvex3bvm@omnistrate-dataplane-host-dev.iam.gserviceaccount.com"
        azure:
          terraformPath: /e2etestv2/original/azure/terraform
          gitConfiguration:
            <<: *git-configuration
  - name: terraformChild2
    internal: true
    terraformConfigurations:
      configurationPerCloudProvider:
        aws:
          terraformPath: /e2etestv2/original/aws/terraform2
          gitConfiguration:
            <<: *git-configuration
          terraformExecutionIdentity: "arn:aws:iam::339713121445:role/omnistrate-custom-terraform-execution-role"
        gcp:
          terraformPath: /e2etestv2/original/gcp/terraform2
          gitConfiguration:
            <<: *git-configuration
          # Identity needs permissions to create PubSub. Following role(s) should be bound: roles/pubsub.admin
          terraformExecutionIdentity: "omnistrate-tf-org-euvvex3bvm@omnistrate-dataplane-host-dev.iam.gserviceaccount.com"
        azure:
          terraformPath: /e2etestv2/original/azure/terraform2
          gitConfiguration:
            <<: *git-configuration
  - name: kustomizeRoot
    type: kustomize
    dependsOn:
      - terraformChild
      - terraformChild2
    compute:
      instanceTypes:
        - name: t4g.small
          cloudProvider: aws
          configurationOverrides:
            taints:
              - key: "example-toleration"
                value: "enabled"
                effect: NoSchedule
        - name: e2-medium
          cloudProvider: gcp
        - name: Standard_B2ms
          cloudProvider: azure
    network:
      ports:
        - 3306
    kustomizeConfiguration:
      kustomizePath: /e2etestv2/original/kustomize
      gitConfiguration:
        <<: *git-configuration
    apiParameters:
      - key: username
        description: Username
        name: Username
        type: String
        modifiable: true
        required: false
        export: true
        defaultValue: username
      - key: password
        description: Default DB Password
        name: Password
        type: String
        modifiable: false
        required: false
        export: false
        defaultValue: postgres
